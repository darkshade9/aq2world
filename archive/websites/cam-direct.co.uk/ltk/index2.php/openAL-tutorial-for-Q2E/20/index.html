
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>The Borg Matrix - openAL-tutorial-for-Q2E</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="keywords" content="License, Kill, Borg, Matrix, games, Quake 2, ltktbm, action, free, openal, ">
<META name="description" content="The Borg Matrix, Economics Modelling, Financial Management, Strategic planning and PC gaming for windows and Linux">
<meta http-equiv='Page-Enter' content='blendTrans(Duration='100')'><link rel="stylesheet" type="text/css" href="/ltk/stdtheme.css" >
<link rel="stylesheet" href="/ltk/menu.css" />
<!--[if IE]>
<link rel="stylesheet" href="/ltk/menuie.css" />
<script type="text/javascript">
window.mlrunShim = true;
</script>
<![endif]-->
<script type="text/javascript" src="/ltk/topmenu.js">
</script>
</head>

<body bgcolor="#000000">
<div align="center"><font color="#FFFFFF">The Borg Matrix, Economics Modelling, Financial Management, Strategic planning and PC gaming for windows and Linux</font></div>
<div align="center"><font color="#FFFFFF">
<script language="JavaScript"> TargetDate = "11/07/2006 9:00 PM"; BackColor = "black"; ForeColor = "white"; CountActive = true; CountStepper = 1; LeadingZero = true; DisplayFormat = "%%D%% Days, %%H%% Hours, %%M%% Minutes, %%S%% Seconds."; </script> <script language="JavaScript" src="countdown.js"></script>


</font></div>
<!--begin header text-->
<table align="center"><TR>
<td align="right" class="maintitle"><img src="/ltk/images/ltkbanner2.gif" width="400" height="106" alt="AQ2 LTKTBM Edition"></td>
<td class="maintitle">
<form method=GET action="/ltk/index2.php">
<input type=hidden name=location value="Dictionary">
<input type=text name=word size=25 maxlength=2048 value=""><BR><font size=-1>
<input type=submit value="Dictionary Search"><span id=hf></span></font>
</form>
</td><TD><!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom" target="_top">
<table border="0" bgcolor="#000000">
<tr><td nowrap="nowrap" valign="top" align="left" height="32">
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25blk.gif" border="0" alt="Google" align="middle"></img></a>
<br/>
<input type="hidden" name="domains" value="www.cam-direct.co.uk"></input>
<label for="sbi" style="display: none">Enter your search terms</label>
<input type="text" name="q" size="31" maxlength="255" value="" id="sbi"></input>
</td></tr>
<tr>
<td nowrap="nowrap">
<table>
<tr>
<td>
<input type="radio" name="sitesearch" value="" checked id="ss0"></input>
<label for="ss0" title="Search the Web"><font size="-1" color="#ffffff">Web</font></label></td>
<td>
<input type="radio" name="sitesearch" value="www.cam-direct.co.uk" id="ss1"></input>
<label for="ss1" title="Search www.cam-direct.co.uk"><font size="-1" color="#ffffff">www.cam-direct.co.uk</font></label></td>
</tr>
</table>
<label for="sbb" style="display: none">Submit search form</label>
<input type="submit" name="sa" value="Search" id="sbb"></input>
<input type="hidden" name="client" value="pub-7138831479577622"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="safe" value="active"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:000000;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:203;L:http://www.cam-direct.co.uk/ltk/images/ltkbanner2.gif;S:http://;FORID:1"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google --></TD></tr></td>
</TR></table>
<!--end header text-->
<!--begin layout table-->

<table width="100%" align="center" border="0" cellspacing="1" cellpadding="0">
<tr bgcolor="#006600" class="maintitle">
<td align="center" class="maintitle"  width="70%"><font size="+3"><b>openAL-tutorial-for-Q2E</b></font></td>
<td align="center" class="maintitle">
<STRONG>Not Logged in : </STRONG><a href="http://www.cam-direct.co.uk/phpBB2/login.php?&sid=1ce5686269f0befb88c925d164e0fdce">Login</a> | <a href="http://www.cam-direct.co.uk/phpBB2/profile.php?mode=register&sid=1ce5686269f0befb88c925d164e0fdce">Register</a> </td>
</tr>
</table>
<table width="100%" align="center" border="0" cellspacing="1" cellpadding="0">
<tr> 
    <td width="80%" valign="top"> 
<!--begin main text-->
<table width="100%">
<tr>
<td class="maintitle" align="center"><div class='mlmenu horizontal fade arrow greenwhite delay inaccesible' align='center' valign='center'><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Main/1'>Main</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/LTKTBM Main/60'>LTKTBM Main</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/3'>Media</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/4'>Docs</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/61'>AQ2</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Contents/21'>Contents</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Readme/22'>Readme</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/AQ2-Commands/23'>AQ2-Commands</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Weapons-and-Items/24'>Weapons-and-Items</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Credits/25'>Credits</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/System-Requirements/47'>System-Requirements</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Changelog/53'>Changelog</a></li><li><a href='http://slacker.home.cosmic-cow.net/confgen/' target='blank'>Config generator</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Wealth of Nations/62'>Wealth of Nations</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Wealth of Nations/63/1/1' onmouseover="return escape('THE CAUSES OF IMPROVEMENT IN THE PRODUCTIVE POWERS OF LABOUR, AND OF THE ORDER ACCORDING TO WHICH ITS PRODUCE IS NATURALLY DISTRIBUTED AMONG THE DIFFERENT RANKS OF THE PEOPLE')" target='_SELF'>Book 1</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Wealth%20of%20Nations/93/2/1' onmouseover="return escape('THE NATURE, ACCUMULATION, AND EMPLOYMENT OF STOCK')" target='_SELF'>Book 2</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Wealth%20of%20Nations/94/3/1' onmouseover="return escape('THE DIFFERENT PROGRESS OF OPULENCE IN DIFFERENT NATIONS')" target='_SELF'>Book 3</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Wealth%20of%20Nations/95/4/1' onmouseover="return escape('SYSTEMS OF POLITICAL ECONOMY')" target='_SELF'>Book 4</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Wealth%20of%20Nations/96/5/1.1.1' onmouseover="return escape('THE REVENUE OF THE SOVEREIGN OR COMMONWEALTH')" target='_SELF'>Book 5</a></li></ul></li></ul></li><li><a href='http://aqmd.telefragged.com/' target='_blank'>maps</a></li><li><a href='http://mods.moddb.com/gallery/964/' target='_blank'>Screenshots</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/20'>Gun-Radio_Interview_Transcript</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Interview-Part-1/26'>Interview-Part-1</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Interview-Part-2/27'>Interview-Part-2</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Stories/50'>Stories</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Story-City/51'>Story-City</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Ragdol-Physics/55'>Ragdol-Physics</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Water-Engine/56'>Water-Engine</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/6'>Downloads</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/LTKTBM/7'>LTKTBM</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Updates/8'>Updates</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Routes/9'>Routes</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Others/10'>Others</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Music/6'>Music</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/News/11'>News</a><ul><li><a href='http://www.cam-direct.co.uk/phpBB2/viewtopic.php?t=3&postdays=0&postorder=desc'>Interim_News</a></li><li><a href='http://www.cam-direct.co.uk/phpBB2/privmsg.php?mode=post&u=1'>Submit_News</a></li><li><a href='http://www.cam-direct.co.uk/ltk/newswire.php'>Global Newswire</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/phpBB2/index.php'>Forums</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/IRC/14'>IRC</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Plans/15'>Plans</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/16'>Developers</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/31'>Game_Engine</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Ragdol-Physics/32'>Ragdol-Physics</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Ragdol-Readme/33'>Ragdol-Readme</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Secure-Client-Identification/43'>Secure-Client-Identification</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL/44'>openAL</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/45'>openAL-tutorial-for-Q2E</a></li><li><a href='http://www.cam-direct.co.uk/phpBB2/viewforum.php?f=23'>openAL/eax_developement_discussion</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Water-Engine/52'>Water-Engine</a></li><li><a href='http://www.cam-direct.co.uk/phpBB2/privmsg.php?mode=post&u=1'>Engine source request</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Artificial_Intelligence/37'>Artificial_Intelligence</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/The_Borg_Matrix/28'>The_Borg_Matrix</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/30'>Agent_Economics</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/milliEcon-v2/29'>milliEcon-v2</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/milliEcon-v1/36'>milliEcon-v1</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Game_of_Life-Earth/35'>Game_of_Life-Earth</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/phpBB2/viewforum.php?f=7&location=The_Borg_Matrix&expand=28'>Pathfinder</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Dictionary/42'>Dictionary</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/TBM_vs_Others/49'>TBM_vs_Others</a></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/CGF-Documentation/38'>CGF-Documentation</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/downloads/dl.php?id=114' target='_blank'>CGF_Grenade_Handling</a></li><li><a href='http://www.cam-direct.co.uk/ltk/downloads/dl.php?id=115' target='_blank'>CGF_Terrain_Handling</a></li></ul></li></ul></li></ul></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/20'>|Gun-Radio_Interview_Transcript|</a><ul><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Interview-Part-1/26'>Interview-Part-1</a></li><li><a href='http://www.cam-direct.co.uk/ltk/index2.php/Interview-Part-2/27'>Interview-Part-2</a></li></ul></ul></div></td></tr></table>
<div align="center"><script type="text/javascript"><!--
google_ad_client = "pub-7138831479577622";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "000000";
google_color_bg = "000000";
google_color_link = "FFFFFF";
google_color_text = "CCCCCC";
google_color_url = "999999";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><br><table width='95%' align='center' border='0' cellspacing='1' cellpadding='0' bgcolor='#345487'><tr><td>
<table width='100%' border='0' cellspacing='0' cellpadding='3' class='maintitle'><tr><td class='maintitle'><img src='/forums/style_images/1/nav_m.gif' border='0'  alt='' width='8' height='8'></td>
<td width='100%' class='maintitle'>Developer Resources - q2a3d implimentation turial for Q2E/Q2MAX </td>
</tr></table></td></tr><tr><td class='mainbg'><table width='100%' border='0' cellspacing='1' cellpadding='4'>
<tr><td class='forum2' width='59%'><p>Introduction:</p>
                        <p>Q2A3D is an openAL (open Audio 
                          Layer) sound implimentation for Quake2 based engines. 
                          However it is also intended to be as portable as possible, 
                          automating many comman audio tasks and providing seemless 
                          integratiion into any game.</p>
                        <p>OpenAL is an LGPL audio platform 
                          compatible with windows/linux/mac which provides access 
                          advanced audio functions such as multi speaker systems, 
                          EAX extensions and much more. It is hardware independant 
                          and similar in implimetation to the OpenGL graphics 
                          library. You can find out more on creatives developer 
                          site @ <a href="http://developer.creative.com" target="_blank">developer.creative.com.</a></font></p>
                        <p>In contrast, Q2A3D is designed 
                          to be similar in implimentation to Q2's ref_soft or 
                          ref_gl graphics engines. providing a simple inteface 
                          for the game engine to issue sounds which are then controled 
                          by the q2a3d audio engine. Below you will find code 
                          &amp; snippets to impliment this audio engine into the 
                          Q2, and Q2E (Q2Max based?) game engines.</p>
                        <p>Q2E (Q2Max?) coding:</p>
                        <p>Requirements: </p>
                        <blockquote> 
                          <p><a href="http://www.cam-direct.co.uk/downloads/developer/q2ma3d.zip">Q2E 
                            (and Q2Max?) engine specific source code</a>.<br>
                            <a href="http://www.cam-direct.co.uk/downloads/updates/a3d95186.zip">The 
                            latest Q2A3D</a> &amp; <a href="http://www.cam-direct.co.uk/downloads/updates/OpenALwEAX.exe">OpenAL 
                            audio engines</a>.</p>
                        </blockquote>
                        <p>Implimentation:</p>
                        <p>First up, you need to add the 
                          engine specific source files into the Q2 project, this 
                          provides Q2A3D implimentations of the Q2 sound functions 
                          (like S_registersound and S_startsound, along with pickchannel 
                          for looping sounds). Extract the Q2E specific code into 
                          a new 'a3d' directory in the main directory (e.g. <em>/q2e 
                          0.23/a3d/q2a3d.c</em>, <em>/q2e 0.23/a3d/q2a3d.h</em>)
                         along with the q2a3d library file 
                          and header ( <em>/q2e 0.23/a3d/q2a3d.lib</em> 
                          and <em>/q2e 0.23/a3d/a3d.h</em>)</p>
                        <p>Next, add the Q2A3D audio engine 
                          functions into the build environment, in MS VC++ 6 this 
                          is done by clicking Project-&gt;Settings, selecting 
                          the quake2 project, clicking the 'LINK' tab on the right 
                          and adding '<em>./a3d/q2a3d.lib</em>'to 
                          the &quot;Object/Library Modules &quot; (in this case 
                          after winmm.lib ). Then add the q2a3d.c and q2a3d.h 
                          to the project using the fileview window.</p>
                        <p>Adding the code:</p>
                        <p>Open snd_local.h,</p>
                        <p>First, add the Id variable to 
                          the sound effects structure:</p>
                        <blockquote> 
                          <p>typedef struct sfx_s 
                            {<br>
                            char name[MAX_QPATH];<br>
                            char trueName[MAX_QPATH];<br>
                            sfxCache_t *cache;<br>
                            //A3D ADD<br>
                            int Id;<br>
                            } sfx_t;</font></p>
                        </blockquote>
                        <p>This is used to control and manipulate 
                          continuous (looping/autosounds) as the audio environment 
                          changes.</p>
                        <p>Next add a copy of the 
                          listener_tstructure and a global snd_listener.</p>
                        <blockquote> 
                          <p>} dma_t;</p>
                          <p>// =====================================================================<br>
                            // snd_dma.c<br>
                            //A3D ADD<br>
                            typedef struct {<br>
                            vec3_t origin;<br>
                            vec3_t axis[3];<br>
                            } listener_t;<br>
                            extern listener_t snd_listener;<br>
                            //A3D ADD END<br>
                            extern playSound_t snd_pendingPlays;</p>
                        </blockquote>
                        <p>Open sound.h, 
                          and at the very top add the q2a3d engine function definitions:</p>
                        <blockquote> 
                          <p>//A3D ADD<br>
                            #include &quot;../a3d/a3d.h&quot;</p>
                        </blockquote>
                        <p>Open snd_dma.c, 
                          </p>
                        <p>At the top find the line
                          #include &quot;snd_local.h&quot;and 
                          add the engine specific function header:</p>
                        <blockquote> 
                          <p>#include &quot;snd_local.h&quot;<br>
                            //A3D ADD<br>
                            #include &quot;../a3d/q2a3d.h&quot;</p>
                        </blockquote>
                        <p>This declares all the functions 
                          we will use, along with the s_a3d cvar to enable/disable 
                          the q2a3d engine.</p>
                        <p>Next, lower down, comment out 
                          the listener_t structure 
                          definition, as described above this is to be moved to 
                          snd_local.h to be used 
                          in the engine specific q2a3d code.</p>
                        <blockquote> 
                          <p>#define SND_LOOPATTENUATE 
                            0.003<br>
                            //A3D CHANGE - moved to snd_local.h<br>
                            /* typedef struct {<br>
                            vec3_t origin;<br>
                            vec3_t axis[3];<br>
                            } listener_t; */<br>
                            //A3D CHANGE END</p>
                        </blockquote>
                        <p>now remove the static declaration 
                          for snd_listener, since 
                          its now a global variable it is no longer needed.</p>
                        <blockquote> 
                          <p>//A3D CHANGE<br>
                            /*static*/ listener_t snd_listener;</p>
                        </blockquote>
                        <p>Move down to the S_RegisterSound function, and add in the A3D replacement, 
                          so it looks like this:</p>
                        <blockquote> 
                          <p>sfx_t *S_RegisterSound 
                            (const char *name){</p>
                          <p> sfx_t *sfx;</p>
                          <p>//A3D ADD<br>
                            if(a3dsound_started)<br>
                            return S_Q2A3DRegisterSound (name);<br>
                            //A3D END</p>
                          <p>if (!snd_initialized)<br>
                            return NULL;</p>
                        </blockquote>
                        <p>Repeat for S_PickChannel:</p>
                        <blockquote> 
                          <p>channel_t *S_PickChannel 
                            (int entNum, int entChannel){</p>
                          <p> channel_t *ch;<br>
                            int chIdx;<br>
                            int firstToDie = -1;<br>
                            int lifeLeft = 0x7fffffff;<br>
                            //A3D ADD<br>
                            if(a3dsound_started)<br>
                            return S_Q2A3DPickChannel(entNum, entChannel);<br>
                            //A3D END</p>
                          <p> if (entChannel &lt; 
                            0)</p>
                        </blockquote>
                        <p>Now move down to S_Startsound</font>. 
                          Here we need to add a check whether the a3d sound engine 
                          has been started, and add the replacement function call.</p>
                        <blockquote> 
                          <p>void S_StartSound 
                            (const vec3_t origin, int entNum, int entChannel, 
                            sfx_t *sfx, float volume, float attenuation, float 
                            timeOfs){</p>
                          <p> sfxCache_t *sc;<br>
                            playSound_t *ps, *sort;<br>
                            int start;<br>
                            //A3D CHANGE<br>
                            if (!snd_initialized &amp;&amp; !a3dsound_started)<br>
                            return;<br>
                            //A3D CHANGE END </p>
                          <p> if (!sfx)<br>
                            return;</p>
                          <p> if (sfx-&gt;name[0] 
                            == '*')<br>
                            sfx = S_RegisterSexedSound(&amp;cl.entities[entNum].current, 
                            sfx-&gt;name);</p>
                          <p> //A3D ADD<br>
                            if (a3dsound_started)<br>
                            {<br>
                            S_Q2A3DStartSound(origin,entNum,entChannel,sfx,volume,attenuation,timeOfs);<br>
                            return;<br>
                            }<br>
                            //A3D END<br>
                            // Make sure the sound is loaded<br>
                            sc = S_LoadSound(sfx);</p>
                        </blockquote>
                        <p>Now add the check for a3d to
                          S_StartLocalSound </p>
                        <blockquote> 
                          <p>void S_StartLocalSound 
                            (sfx_t *sfx){</p>
                          <p> //A3D CHANGE<br>
                            if (!snd_initialized &amp;&amp; !a3dsound_started)<br>
                            return;<br>
                            //A3D CHANGE END</p>
                          <p> if (!sfx)<br>
                            return;</p>
                        </blockquote>
                        <p>Now move to S_StopAllSoundsand change it as follows </p>
                        <blockquote> 
                          <p>void S_StopAllSounds 
                            (void){</p>
                          <p> int i;</p>
                          <p>//A3D CHANGE<br>
                            if(a3dsound_started)<br>
                            S_Q2A3DStopAllSounds();</p>
                          <p> if (!snd_initialized 
                            &amp;&amp; !a3dsound_started )<br>
                            return;</p>
                          <p>// Clear all the 
                            playsounds<br>
                            memset(snd_playSounds, 0, sizeof(snd_playSounds));<br>
                            snd_freePlays.next = snd_freePlays.prev = &amp;snd_freePlays;<br>
                            snd_pendingPlays.next = snd_pendingPlays.prev = &amp;snd_pendingPlays;</p>
                          <p>for (i = 0; i &lt; 
                            MAX_PLAYSOUNDS; i++){<br>
                            snd_playSounds[i].prev = &amp;snd_freePlays;<br>
                            snd_playSounds[i].next = snd_freePlays.next;<br>
                            snd_playSounds[i].prev-&gt;next = &amp;snd_playSounds[i];<br>
                            snd_playSounds[i].next-&gt;prev = &amp;snd_playSounds[i];<br>
                            }</p>
                          <p> // Clear all the 
                            channels<br>
                            memset(snd_channels, 0, sizeof(snd_channels));<br>
                            <br>
                            // Stop the background track<br>
                            S_StopBackgroundTrack();</p>
                          <p>snd_rawEnd = 0;</font></p>
                          <p>snd_soundTime = 
                            0;<br>
                            snd_paintedTime = 0;<br>
                            if(a3dsound_started)<br>
                            return;<br>
                            S_ClearBuffer();<br>
                            }//A3D CHANGE END</p>
                        </blockquote>
                        <p>This makes sure all the sounds 
                          are stopped, and S_Clearbuffer isn't run when the a3d 
                          engine is active.</p>
                        <p>Next move to S_FreeSounds 
                          and prevent it being run if the a3d engine is active.</p>
                        <blockquote> 
                          <p>int i;<br>
                            //A3D ADD<br>
                            if(a3dsound_started)<br>
                            return;<br>
                            // Free all sounds</p>
                        </blockquote>
                        <p>Currently, there is no implimentation 
                          for 'freeing' sounds as such with Q2A3D, it just has 
                          a set cache of datafiles, which it fills and replaces 
                          and frees as nessecery.</p>
                        <p>Next move to
                          S_update and add the Q2A3D replacement.</p>
                        <blockquote> 
                          <p>int samps;<br>
                            //A3D ADD<br>
                            if (a3dsound_started)<br>
                            {<br>
                            S_Q2A3DUpdate(origin,axis[0],axis[1],axis[2]);<br>
                            return;<br>
                            }<br>
                            //A3D END<br>
                            if (!snd_initialized)<br>
                            return;</p>
                        </blockquote>
                        <p>This Function is quite deceptive 
                          with the scope it actually covers. Q2 initializes sounds 
                          which continually loop (such as entity noises like the 
                          blaster fizz) as 'autosounds' this function updates 
                          the audio environement so these sounds are placed correctly 
                          based on the listener position and orientation. Q2A3D 
                          tags these sounds with 'id's' which automatically initiates 
                          them as as looping sounds and allows them to be updated. 
                          This id 'tagging' is handled jointly by S_startsound 
                          and S_pickchannel.</p>
                        <p>Now, onto the initialization 
                          code. Move down futher still to S_Init 
                          and add the s_a3d cvar initialization:</p>
                        <blockquote> 
                          <p>s_testSound = Cvar_Get(&quot;s_testSound&quot;, 
                            &quot;0&quot;, CVAR_CHEAT);</p>
                          <p> //A3D ADD<br>
                            s_a3d = Cvar_Get (&quot;s_a3d&quot;, &quot;0&quot;, 
                            CVAR_ARCHIVE); //sound engine</p>
                          <p> Cmd_AddCommand(&quot;play&quot;, 
                            S_Play_f);</p>
                        </blockquote>
                        <p>Still in S_Init, add the call 
                          to initialize q2a3d if required:</p>
                        <blockquote> 
                          <p>Cmd_AddCommand(&quot;snd_restart&quot;, 
                            S_Restart_f);<br>
                            //A3D CHANGE<br>
                            if(s_a3d-&gt;integer)<br>
                            {<br>
                            S_Q2A3DInit();<br>
                            }<br>
                            else<br>
                            {<br>
                            if (!S_InitDMA()){<br>
                            Com_Printf(&quot;------------------------------------\n&quot;);<br>
                            return;<br>
                            }<br>
                            <br>
                            <br>
                            snd_initialized = true;<br>
                            S_SoundInfo_f();<br>
                            }<br>
                            S_InitScaleTable();<br>
                            // num_sfx = 0;<br>
                            <br>
                            // soundtime = 0;<br>
                            // paintedtime = 0;<br>
                            <br>
                            //A3D CHANGE END </p>
                          <p> S_StopAllSounds();</p>
                        </blockquote>
                        <p>Finally forsnd_dma.c 
                          move down a few lines to S_Shutdown 
                          and add the call to shutdown Q2A3D if required:</p>
                        <blockquote> 
                          <p>void S_Shutdown (void){<br>
                            <br>
                            //A3D CHANGE<br>
                            if(a3dsound_started)<br>
                            A3D_Shutdown();<br>
                            a3dsound_started = 0;<br>
                            //A3D CHANGE END</p>
                          <p> Cmd_RemoveCommand(&quot;play&quot;);</p>
                        </blockquote>
                        <p>Now, just a few minor changes 
                          to snd_mem.c:</p>
                        <p>Firstly, add the engine specific 
                          header file:</p>
                        <blockquote> 
                          <p>#include &quot;snd_local.h&quot;<br>
                            //A3D ADD<br>
                            #include &quot;../a3d/q2a3d.h&quot;</p>
                        </blockquote>
                        <p>Last, but by no means least, 
                          move to S_LoadSound and 
                          prevent Q2 from loading the sound:</p>
                        <blockquote> 
                          <p>int length;<br>
                            //A3D CHANGE<br>
                            if (sfx-&gt;name[0] == '*' || a3dsound_started)<br>
                            return NULL;<br>
                            //A3D CHANGE END<br>
                            // See if still in memory<br>
                            if (sfx-&gt;cache)</font></p>
                        </blockquote>
                        <p>You can <a href="http://www.cam-direct.co.uk/downloads/developer/q2ma3d.zip">download 
                          direct replacement source files</a> (snd_mem.c and snd_dma.c) 
                         for Q2E v0.23 from 
                          here. I believe this tutorial + source should work equally 
                          well with Q2Max based engines although I have not tried 
                          it myself. You will have to make the changes to snd_local.h 
                          and sound.h yourself.</p></td></tr>
<tr><td class='mainfoot' colspan='5'>&nbsp;</td></tr> </table></td></tr></table><BR>
<div align="center"><script type="text/javascript"><!--
google_ad_client = "pub-7138831479577622";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "000000";
google_color_bg = "000000";
google_color_link = "FFFFFF";
google_color_text = "CCCCCC";
google_color_url = "999999";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
</td>
<!--end main text-->
	
	<td valign="top" width="20%">
	<!--start menu-->
<table width='100%' border='1' cellspacing='1' cellpadding='1' align='center' bordercolor='#aaaadd' bordercolorlight='#bbbbff' bordercolordark='#000033'><tr><td height='22' class='maintitle'><nobr><a href="http://www.cam-direct.co.uk/ltk/index2.php/Main/1">Main</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/3">Media</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/4">Docs</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://aqmd.telefragged.com/" target="_blank">maps</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://mods.moddb.com/gallery/964/" target="_blank">Screenshots</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/20">Gun-Radio_Interview_Transcript</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Interview-Part-1/26">Interview-Part-1</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branchbottom.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Interview-Part-2/27">Interview-Part-2</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Stories/50">Stories</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Ragdol-Physics/55">Ragdol-Physics</a></nobr><br/>
<nobr><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branchbottom.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Water-Engine/56">Water-Engine</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/6">Downloads</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/News/11">News</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/phpBB2/index.php">Forums</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/IRC/14">IRC</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Plans/15">Plans</a></nobr><br/>
<nobr><img src="/ltk/TMimages/branchbottom.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/16">Developers</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/31">Game_Engine</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Ragdol-Physics/32">Ragdol-Physics</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Secure-Client-Identification/43">Secure-Client-Identification</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL/44">openAL</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/openAL-tutorial-for-Q2E/45">openAL-tutorial-for-Q2E</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branchbottom.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/phpBB2/viewforum.php?f=23">openAL/eax_developement_discussion</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branch.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Water-Engine/52">Water-Engine</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/line.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branchbottom.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/phpBB2/privmsg.php?mode=post&u=1">Engine source request</a></nobr><br/>
<nobr><img src="/ltk/TMimages/linebottom.gif" width="20" height="20" align="top"/><img src="/ltk/TMimages/branchbottom.gif" width="20" height="20" align="top" border="0" /><a href="http://www.cam-direct.co.uk/ltk/index2.php/Artificial_Intelligence/37">Artificial_Intelligence</a></nobr><br/>
</td></tr></table><br><table width='95%' align='center' border='0' cellspacing='1' cellpadding='0' bgcolor='#345487'><tr><td>
<table width='100%' border='0' cellspacing='0' cellpadding='3' class='maintitle'><tr><td class='maintitle'><img src='/forums/style_images/1/nav_m.gif' border='0'  alt='' width='8' height='8'></td>
<td width='100%' class='maintitle'>Word of the week</td>
</tr></table></td></tr><tr><td class='mainbg'><table width='100%' border='0' cellspacing='1' cellpadding='4'>
<tr><td class='forum2' width='59%'><a href='/ltk/index2.php/Dictionary/42/onyx/79584/#tbm_79584'><B>onyx</B><BR>a chalcedony with alternating black and white bands; used in making cameos </a></td></tr>
<tr><td class='mainfoot' colspan='5'>&nbsp;</td></tr> </table></td></tr></table><BR>
	<table width="20%" border="0" cellspacing="2" cellpadding="0" align="left">



  <tr bgcolor="#000000"> 
    <td height="22"> 
      <div align="center"><b><font color="#FFFFFF">Respect to:</font><BR><a href="http://www.moddb.com/" target="_blank"><img src="/ltk/images/moddb.gif" width="88" height="31" border="0" alt="modDB.com - every game, every mod, one site... go figure!"></a></font></b><BR>
<a href="http://www.actiongames.co.uk/" target="_blank"><img src="/ltk/images/aglogo.gif" width="87" height="51" alt="Action Games"></a><BR>
<a href="http://www.aq2world.com" target="_blank"><img src="/ltk/images/button_aq2w.gif" width="88" height="31" alt="AQ2World"></a></div>
<a href="http://aqmd.telefragged.com/" target="_blank"><img src="/ltk/images/aqmd.gif" width="88" height="31" alt="AQMD"></a></div>
    </td>
  </tr>
  <tr bgcolor="#000000"> 
    <td> 
      <div align="center"><b><font color="#ffffff"><BR>Supporting:</font><BR> 
<a href=http://www.againsttcpa.com/what-is-tcpa.html target="_blank"><img src="/ltk/images/TCPA.gif" width="88" height="31" alt="Against TCPA"></a>
<a href="http://www.no2id.net/" style="position:relative;font-size:16px;color:white;background-color:black;font-family:'Trebuchet MS',Arial, Helvetica, sans-serif;font-weight:bold;padding:2px;border:#c00 solid 2px;text-decoration:none;" title="NO2ID - Stop ID cards & the database state">N<span style="color:#c00">&Oslash;</span>2ID</a></div>
    </td>
  </tr>
  
  <tr bgcolor="#000000"> 
    <td> 
	<div align="center"><b><font color="#ffffff"><BR>Donate:</font><BR> 
 <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_xclick">
<input type="hidden" name="business" value="markj.parker@ntlworld.com">
<input type="hidden" name="item_name" value="LTKTBM developement fund">
<input type="hidden" name="amount" value="5.00">
<input type="hidden" name="no_shipping" value="1">
<input type="hidden" name="return" value="http://www.cam-direct.co.uk/ltk/index2.php?location=paypal">
<input type="hidden" name="no_note" value="1">
<input type="hidden" name="currency_code" value="GBP">
<input type="hidden" name="tax" value="0">
<input type="hidden" name="bn" value="PP-DonationsBF">
<input type="image" src="http://www.cam-direct.co.uk/ltk/images/banner_intl.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!">
<img alt="" border="0" src="https://www.paypal.com/en_GB/i/scr/pixel.gif" width="1" height="1">
</form></div><BR>
<script type="text/javascript"><!--
google_ad_client = "pub-7138831479577622";
google_ad_width = 110;
google_ad_height = 32;
google_ad_format = "110x32_as_rimg";
google_cpa_choice = "CAAQ463zzwEaCHRtWdgIj_1IKLPGvnUwAA";
google_ad_channel = "";
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
  </td>
  </tr>


</table>
<!--end menu-->

</td>
</tr>
</table>
<!--end layout table-->
<table width="100%" align="center" border="0" cellspacing="1" cellpadding="0">
<tr width="100%" bgcolor="#006600">
<td align="center" class="maintitle"><font size="+3"><b>
<table width="20%" border="2" cellspacing="2" cellpadding="2" align="center" bordercolor="#000000" bordercolorlight="#666666" bordercolordark="#666666">
  <tr bgcolor="#CCCCCC" class='maintitle'>
    <td height="22" class='maintitle'> 
      <div align="center"><b><font color="#FFFFFF"><a href="/ltk/index2.php?location=Main">MAIN</a></font></b></div>
    </td>
	<td height="22" class='maintitle'> 
      <div align="center"><b><font color="#FFFFFF"><a href="/ltk/index2.php?location=News">NEWS</a></font></b></div>
    </td>
	<td height="22" class='maintitle'> 
      <div align="center"><b><font color="#FFFFFF"><a href="/ltk/index2.php?location=IRC" target="_blank">IRC</a></font></b></div>
    </td>
    <td height="22" class='maintitle'> 
      <div align="center"><b><font color="#FFFFFF"><a href="/phpBB2/viewforum.php?f=21">BUGS</a></font></b></div>
    </td>
    <td height="22" class='maintitle'> 
      <div align="center"><b><font color="#FFFFFF"><a href="/ltk/index2.php?location=Plans">PLANS</a></font></b></div>
    </td>
    <td height="22" class='maintitle'> 
      <div align="center"><b><font color="#FFFFFF"><a href="/ltk/index2.php?location=LTKTBM&expand=6">DOWNLOADS 
        </a></font></b></div>
		</td>
    <td height="22" class='maintitle'> 
		<div align="center"><b><font color="#FFFFFF"><a href="/ltk/index2.php?location=Dictionary&expand=28">Developers(dictionary)
        </a></font></b></div>
    </td>
  </tr>
</table>
</b></font></td>
</tr>
</table>
<script language="JavaScript" type="text/javascript" src="/ltk/menu/wz_tooltip.js"></script>
</body>
</html>
