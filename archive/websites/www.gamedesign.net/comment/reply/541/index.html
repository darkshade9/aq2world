	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
	<html>
		<head>
			<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><base href="http://www.gamedesign.net/" />
<style type="text/css">
@import url(http://assets.aq2world.com/archive/websites/www.gamedesign.net/drupal.css);
</style>
			<title>
				RUST - Gamedesign.net
			</title>
			<link rel="stylesheet" type="text/css" href="themes/rusted/http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/rusted.css">
			<style type="text/css">
				@import "themes/rusted/http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/rusted.css";
			</style>
		</head>
		<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" bgcolor="#000000">
	<table width="900" height="24" border="0" cellspacing="0" cellpadding="0" bgcolor="#000000"><tr><td align="left" valign="middle" width="40"><img src="/images/smalltf.gif" width="40" height="24" alt=""></td><td align="left" valign="middle"  width="250"><div class="networkBar">&nbsp;&nbsp;<A href="http://www.telefragged.com">TeleFragged</a>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;<A href="http://www.telefragged.com/network">Network</a>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;<A href="http://www.3ddownloads.com">Downloads</a>&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;&nbsp;&nbsp;&nbsp;</div></td><td align="right" valign="middle" width="610"><div class="networkBar3"><iframe width=610 height=18 marginwidth=0 marginheight=0 frameborder=0 scrolling=no src="http://www.ugo.com/syndicatedContent/todayOnUGO/680x18_IframeContent.asp?channel=games&site=gamebanshee&bgcolor=000000&fontcolor=ffffff"></iframe></div></td></tr></table>
			<table bgcolor="000000" width="900" border="0" bordercolor="FFFFFF" cellpadding="0" cellspacing="0">
				<tr>
					<td colspan="5"><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/mh_top.jpg" width="900" height="88" /></td>
				</tr>
				<tr>
					<td valign="top" width="7"><img src="images/mh_lowerbg1.jpg" width="7" height="150" /></td><td valign="top" width="150"><!-- Left Sidebar --><table border="0" cellpadding="0" cellspacing="0">
							<tr>
								<td valign="center" background="images/lsb_firstheader.jpg" width="150" height="24">
									<div align="center" class="sidebar_head">Navigation</div>
								</td>
							</tr>
							<tr><td valign="top" background="images/lsb_bodybg.jpg" width="150"><img src="images/lsb_bodytop.jpg" width="150" height="1" /><div class="sidebar">- <a href="http://www.gamedesign.net/" title="Return to the main page.">home</a><br />- <a href="http://www.gamedesign.net/book" title="Read and contribute to the collaborative books.">Handbooks</a><br />- <a href="http://assets.aq2world.com/archive/websites/www.gamedesign.net/node/view/14" title="">Community</a><br />- <a href="http://assets.aq2world.com/archive/websites/www.gamedesign.net/node/view/13" title="Learn more about the crazy kids running this joint.">Staff</a><br />- <a href="http://www.gamedesign.net/poll" title="View the list of polls on this site.">Polls</a><br />- <a href="http://www.gamedesign.net/search" title="Search for older content.">Search</a><br />- <a href="http://www.gamedesign.net/user" title="Create a user account, request a new password or edit your account settings.">My account</a></div><img src="images/lsb_bodybottom.jpg" width="150" height="1" /></td></tr>
							<tr><td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td></tr>
							<tr>
								<td valign="center" background="images/lsb_header.jpg" width="150" height="24">
									<div align="center" class="sidebar_head">Editing Handbooks</div>
								</td>
							</tr>
							<tr><td valign="top" background="images/lsb_bodybg.jpg" width="150"><img src="images/lsb_bodytop.jpg" width="150" height="1" /><div class="sidebar">							
										- <a href="/book/view/1?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Half-Life</a><br />- <a href="/book/view/11?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Quake II</a><br />- <a href="/book/view/12?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Quake III</a><br />- <a href="/book/view/111?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Generic</a><br />- <a href="/book/view/58?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Interviews</a><br />- <a href="/book/view/128?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Kingpin</a><br />- <a href="/book/view/167?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Doom 3</a><br />- <a href="/book/view/532?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">Modeling</a><br />- <a href="/book/view/549?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">RUST Resumes</a><br />- <a href="/book/view/14?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">RUST Community</a><br />- <a href="/book/view/630?PHPSESSID=4eb417a14503447d3a5e84b093b9e2e8">RUST Competition</a><br />									</div><img src="images/lsb_bodybottom.jpg" width="150" height="1" /></td></tr><tr>
								<td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td>
							</tr>
																						<tr><td valign="center" background="images/lsb_header.jpg" width="150" height="24"><div align="center" class="sidebar_head">Advertisement</div></td> </tr>
								<tr><td valign="top" background="images/lsb_bodybg.jpg" width="150"><img src="images/lsb_bodytop.jpg" width="150" height="1" /><div class="sidebar" align="center"><!-- AdSpace Network=ugo size=120x600 adtype=under affiliate=telefragged suba=telefragged channel=games subchannel=pc category=fps PT=hp CR=mi pez=tic --><iframe width=120 height=600 marginwidth=0 marginheight=0 frameborder=0 bordercolor=000000 scrolling=no src="http://mediamgr.ugo.com:80/html.ng/Network=ugo&size=120x600&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"><script language="javascript1.1" src="http://mediamgr.ugo.com:80/js.ng/params.richmedia=yes&Network=ugo&size=120x600&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"></script><noscript><a href="http://mediamgr.ugo.com:80/click.ng/params.richmedia=yes&Network=ugo&size=120x600&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"><img src="http://mediamgr.ugo.com:80/image.ng/params.richmedia=yes&Network=ugo&size=120x600&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic" border=0></a></noscript></iframe><!-- /AdSpace -->
</div><img src="images/lsb_bodybottom.jpg" width="150" height="1" /></td></tr>
								<tr><td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td></tr>
													</table>
					</td>
					<td valign="top" width="7"><img src="images/mh_lowerbg2.jpg" width="7" height="90" /></td>
					<td valign="top">
						<!-- Body and Right Sidebar -->
						<table width="729" border="0" bordercolor="FFFFFF" cellpadding="0" cellspacing="0">
							<tr><td valign="top" background="images/mh_lowerbg_ad.jpg" colspan="3"><!-- AdSpace Network=ugo size=728x90 adtype=under affiliate=telefragged suba=telefragged channel=games subchannel=pc category=fps PT=hp CR=mi pez=tic --><iframe width=728 height=90 marginwidth=0 marginheight=0 frameborder=0 bordercolor=000000 scrolling=no src="http://mediamgr.ugo.com:80/html.ng/Network=ugo&size=728x90&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"><script language="javascript1.1" src="http://mediamgr.ugo.com:80/js.ng/params.richmedia=yes&Network=ugo&size=728x90&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"></script><noscript><a href="http://mediamgr.ugo.com:80/click.ng/params.richmedia=yes&Network=ugo&size=728x90&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"><img src="http://mediamgr.ugo.com:80/image.ng/params.richmedia=yes&Network=ugo&size=728x90&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic" border=0></a></noscript></iframe><!-- /AdSpace -->
<!-- START RedSheriff Customer Intelligence V4 - Java v1.1  Revision: 1.8 -->
<!-- COPYRIGHT 2002 Red Sheriff Limited -->
<script language="JavaScript"><!--
var pCid="us_us-ugo_network-telefragged";
var w0=1;
var refR=escape(document.referrer);
if (refR.length>=252) refR=refR.substring(0,252)+"...";
//--></script>
<script language="JavaScript1.1"><!--
var w0=0;
//--></script>
<script language="JavaScript1.1" src="http://server-us.imrworldwide.com/a1.js">
</script>
<script language="JavaScript"><!--
if(w0){
var imgN='<img src="http://server-us.imrworldwide.com/cgi-bin/count?ref='+
        refR+'&cid='+pCid+'" width=1 height=1>';
if(navigator.userAgent.indexOf('Mac')!=-1){document.write(imgN);
}else{
        document.write('<applet code="Measure.class" '+
        'codebase="http://server-us.imrworldwide.com/"'+'width=1 height=2>'+
        '<param name="ref" value="'+refR+'">'+'<param name="cid" value="'+pCid+
        '"><textflow>'+imgN+'</textflow></applet>');
        }
}
document.write("<COMMENT>");
//-->
</script>
<noscript>
<img src="http://server-us.imrworldwide.com/cgi-bin/count?cid=us_us-ugo_network-telefragged" width=1 height=1>
</noscript>
</COMMENT>
<!-- END RedSheriff Customer Intelligence V4 --></td></tr>
							<tr><td valign="top" height="7" colspan="3"><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7"></td></tr>
							<tr>
								<td colspan="3">
								<table width="729" border="0" bordercolor="FFFFFF" cellpadding="0" cellspacing="0"><tr><td>
								<td valign="top" width="422" height="250">
									<table width="422" height="250" border="0" cellspacing="0" cellpadding="0">
										<tr><td height="23" valign="center" background="images/midbar_head.jpg"><div align="center" class="sidebar_head">Rust Community Forums</div></td></tr>
										<tr><td valign="top" background="images/midbar_body.jpg"><img src="images/midbar_top.jpg" /><div class="sidebar"><a href="http://forums.gamedesign.net/"><strong>View the Forums</strong></a> | <a href="http://forums.gamedesign.net/profile.php?mode=register">Sign up for an Account</a> <br><small>This panel is updated every 30 minutes.</small><br><br>
											<table border=0 width="100%"><tr><td><strong>Topic Name</strong></td><td><strong>Forum</strong></td><td><strong>Last post by</strong></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209624#209624">Fullscreen vs. Windowed Mode</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=50">Doom III</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=310">tmg</a></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209623#209623">athlon vs intel</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=24">Off-Topic</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=1835">kold</a></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209622#209622">DOOM 3 SDK released!</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=50">Doom III</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=2287">Method</a></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209619#209619">Compo One Discussion.</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=80">RUST Competitions</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=14116">W01f</a></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209615#209615">New DM Map Frag'n'Die3</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=12">Kingpin</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=277">MrDamage</a></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209614#209614">New COLORS CTF Map By Dread</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=12">Kingpin</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=277">MrDamage</a></td></tr>
<tr><td><a href="http://forums.gamedesign.net/viewtopic.php?p=209611#209611">Method</a></td><td><a href="http://forums.gamedesign.net/viewforum.php?f=81">RUST .plan</a></td><td><a href="http://forums.gamedesign.net/profile.php?mode=viewprofile&u=2287">Method</a></td></tr>
</table>
</div></td></tr><tr><td valign="bottom"><img src="images/midbar_bottom.jpg" /></td></tr></table></td>
								<td valign="top" width="7" height="250"><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7"></td>
								<td valign="top" width="300" height="250">
									<!-- AdSpace Network=ugo size=300x250 adtype=under affiliate=telefragged suba=telefragged channel=games subchannel=pc category=fps PT=hp CR=mi pez=tic --><iframe width=300 height=250 marginwidth=0 marginheight=0 frameborder=0 bordercolor=000000 scrolling=no src="http://mediamgr.ugo.com:80/html.ng/Network=ugo&size=300x250&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"><script language="javascript1.1" src="http://mediamgr.ugo.com:80/js.ng/params.richmedia=yes&Network=ugo&size=300x250&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"></script><noscript><a href="http://mediamgr.ugo.com:80/click.ng/params.richmedia=yes&Network=ugo&size=300x250&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic"><img src="http://mediamgr.ugo.com:80/image.ng/params.richmedia=yes&Network=ugo&size=300x250&adtype=under&affiliate=telefragged&suba=telefragged&channel=games&subchannel=pc&category=fps&PT=hp&CR=mi&pez=tic" border=0></a></noscript></iframe><!-- /AdSpace -->
								</td></tr></table> </td>
							</tr>
							<tr>
								<td valign="top" height="7" colspan="3"><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7"></td>
							</tr>							<tr>
								<td width="729" valign="top">
									<table border="0" width="522" cellpadding="0" cellspacing="0">
										<tr>
											<td valign="top" width="522" height="52" background="images/body_header.jpg">
												<div align="center" class="body_title">RUST - Gamedesign.net</div>
											</td>
										</tr>
										<tr>
											<td valign="top" background="images/body_bg.jpg" width="522">
												<div class="body">

<!-- Node: "Sentry continued: adding Sentry-parts box and hud-icon" -->
<div class="body_box_header">Sentry continued: adding Sentry-parts box and hud-icon</div>
<div class="body_box"><small>Submitted by <a href="http://www.gamedesign.net/user/view/95" title="View user profile.">Cheesemonster</a> on Sunday, August 15, 2004 - 07:59</small><br /><br />
<h3>Half-Life</h3>
<blockquote>
	<b>Adding Sentry-parts box and hud-icon to the Sentry Tutorial</b> by <a href="http://rcbot.bots-united.com/emailuser.php?u=1">Cheesemonster</a> .
</blockquote>

<h3>Introduction</h3>

<p>
This tutorial is to add a little more to the sentry tutorial. You are going to add a new entity which will be the "sentryparts" box you will use to make a sentry. Also a hud sprite will show up when you have the sentry parts. 
</p>
<hr noshade color="black">
<h3>Setting up the player</h3>

<p>
Each player must now need to know whether they have sentry parts or not so they can build the sentry.</p>
<p>
First you should add new variables in CBasePlayer class... open "player.h" and insert these into the CBasePlayer class, make them public or private if you want.</p>

<font color="red"><pre>
int m_iGotSentryParts; // is 1 when you have the parts. Initialise it to 0 at spawn 
int m_iPrevGotSentryParts; // Used to find out if we need to show the sprite on the HUD 
</pre></font>
 
<p>
Open up player.cpp and initialise these values at CBaseplayer::Spawn()... </p>

<font color="red"><pre>
   m_iPrevGotSentryParts   = 0; // Dont set this anywhere else except in UpdateClientData ONCE! 
   m_iGotSentryParts       = 0; 
</pre></font>

<p>
Just as a precaution, go into CBasePlayer::PreThink() and add this... </p>

<font color="red"><pre>

   if( !IsAlive() ) 
      m_iGotSentryParts = 0; 
</pre></font>

<p>
This is so the player loses the sentry parts when the player dies.
</p>

<h3>Making the sentry parts</h3>

<p>
Okay thats the variables set up. Now we need to make an entity that will be the sentry parts. The sentry parts will be a little box you have to pick up.</p>
<p>
Open up "MySentry.cpp" and add a new class at the end of the file. </p>

<font color="red"><pre>

class CMySentry_Pickup : public CBaseEntity 
{ 
public: 
   void Spawn(void); 
   void Precache(void); 
   void EXPORT PickupTouch(CBaseEntity *pOther); 
}; 

LINK_ENTITY_TO_CLASS( MySentry_parts, CMySentry_Pickup ); 

/*Dont forget this, 'MySentry_parts' will be the classname, 
you can change this, although they need to match up with the rest of the code. */
</pre></font>
 
<p>
Next we'll have the spawn function, where we call precache, initialise variables and set the touch function to PickupTouch() </p>

<h4>Sentry parts class methods</h4>

<font color="red"><pre>

void CMySentry_Pickup :: Spawn(void) 
{ 
   Precache(); 

   SET_MODEL(ENT(pev),"models/w_isotopebox.mdl"); // We'll use the isotope box model at the moment 

   UTIL_SetSize(pev,Vector(-16,-16,-16),Vector(16,16,16)); 
   UTIL_SetOrigin(pev,pev->origin); 

   pev->spawnflags        &= ~SF_NORESPAWN; 

   pev->gravity            = 1; 
   pev->solid              = SOLID_TRIGGER; // You can walk through it but you can touch it! 

   pev->health             = 100; 
   pev->max_health         = pev->health; 
   pev->takedamage           = DAMAGE_NO; 
   pev->deadflag      = DEAD_NO; 

   pev->movetype      = MOVETYPE_FLY; 
   pev->sequence      = 0; 
   pev->frame      = 0; 

   pev->nextthink          = gpGlobals->time + 0.1; 

   SetTouch(PickupTouch); 
    
} 
</pre></font>

<p>
The precahce funtion should be simple.. below 
</p>

<font color="red"><pre>

void CMySentry_Pickup :: Precache(void) 
{ 
   PRECACHE_MODEL("models/w_isotopebox.mdl"); 
} 
 
</pre></font>

<p>
The pickupTouch function is called when something touches the box, so we want to check if a player touches it, if so, set the sentry parts to 1 for that player and remove the box. </p>

<font color="red"><pre>

void CMySentry_Pickup :: PickupTouch (CBaseEntity *pOther) 
{ 
   if( pOther->pev->flags & FL_CLIENT ) 
   { 
      CBasePlayer *pPlayer = GetClassPtr((CBasePlayer*)pOther->pev); 

      if( pPlayer && !pPlayer->m_iGotSentryParts ) // Check if we can pick it up 
      { 
         pPlayer->m_iGotSentryParts = 1; 

         Killed(pev,GIB_NEVER); // Remove the parts 
      } 
   } 
} 
</pre></font>

<p>Save and build, You can now spawn this entity in the map by spawning the classname you specified in the LINK_ENTITY_TO_CLASS call. </p>

<h3>Build the sentry with sentry parts</h3>

<p>It isn't totally finished yet, we need to change the command to build the sentry and then add the HUD icon. </p>

<p>First, open up client.cpp and goto your "build_Sentry" command you have, and change it to this.. </p>

<font color="red"><pre>

   else if ( FStrEq(pcmd, "build_sentry" ) ) 
   {                            
      if( m_pPlayer->m_Sentry ) 
      { 
         ClientPrint( &pEntity->v, HUD_PRINTCENTER, "Sentry Already Built!\n"); 
      } 
      else 
      { 
         if( m_pPlayer->m_iGotSentryParts ) // got the parts? 
         { 
            Vector origin = UTIL_ForwardPosition(pEntity,64.0); 
             
            origin.z = m_pPlayer->pev->absmin.z + 24; 
             
            CBaseEntity *Sentry = CBaseEntity::Create( "MySentry", origin, pev->angles, pEntity ); 
             
            if( !FNullEnt(Sentry->edict()) ) 
            {                
               m_pPlayer->m_Sentry = Sentry; 
                
               Sentry->pev->owner  = pEntity; 
                
               ClientPrint( pev, HUD_PRINTCENTER, "Building Sentry...\n"); 
               m_pPlayer->m_iGotSentryParts = 0; // Set parts to zero since we've used them 
            } 
            else 
               ALERT(at_console,"Error allocating new edict for sentry!\n"); 
         } 
         else 
            ClientPrint( &pEntity->v, HUD_PRINTCENTER, "You don't have any sentry parts!\n"); 
      } 
   } 
</pre></font>

<h3>Setting up the HUD icon</h3>

<h4>Server-side</h4>

<p>
Thats the main stuff done, now the hud stuff, to do this we need to make a new user message and stuff in the client dll. </p>
<p>
First let's make the messages, open up player.h and look in the code where a lot of integer variables called gmsg[SOMETHING] are being declared, i.e. search for "gmsgGeigerRange" and you'll see the line.. <em>"int gmsgGeigerRange = 0;"</em>, put this underneath it... </p>

<font color="red"><pre>

int gmsgSentryParts = 0; 
</pre></font>

<p>
Now go into LinkUserMessages() in player.h and where there are a lot of variables being set to a REG_USER_MSG, add a new one underneath them liek this.. </p>

<font color="red"><pre>

   gmsgSentryParts = REG_USER_MSG("SentryParts",1); 
</pre></font> 

<p>Now staying in player.cpp, goto UpdateClientData() and after the HIDE_HUD stuff, add these lines </p>

<font color="red"><pre>

   if ( m_iPrevGotSentryParts != m_iGotSentryParts ) 
   { 
      int write_byte = 0; 

      if( m_iGotSentryParts ) 
         write_byte = 1; 

      MESSAGE_BEGIN( MSG_ONE, gmsgSentryParts, NULL, pev ); 
         WRITE_BYTE( write_byte ); 
      MESSAGE_END(); 

      m_iPrevGotSentryParts = m_iGotSentryParts; 
   } 
</pre></font>

<p>That should be all the message stuff figured out, now save all the files and build. </p>

<h4>Client-side</h4>

<p>Now open up the cl_dll workspace and open up hud.h and add the new HUD class (after the declaration of CHUDBase of course!) </p>

<font color="red"><pre>

class CHudSentryParts: public CHudBase 
{ 

public: 

   int Init( void ); 
   int VidInit( void ); 
   int Draw(float flTime); 
   int MsgFunc_SentryParts(const char *pszName,  int iSize, void *pbuf ); 

private: 

   HSPRITE m_hSpriteSentryParts1; 
}; 
</pre></font>

<p>
Go further down the hud.h file now and search for "GetSpriteIndex", below it you'll see a few lines declaring classess as variable structures, below them add the new line </p>

<font color="red"><pre>

   CHudSentryParts      m_SentryParts; 
</pre></font>

<p>
That should be all int hud.h, now open up "hud.cpp"... Search for ".Init()" and where you find it, add the new line below it.. </p>

<font color="red"><pre>

   m_SentryParts.Init(); 
</pre></font>

<p>
Now search for ".VidInit" and add the new line below one of the found lines </p>

<font color="red"><pre>

   m_SentryParts.VidInit(); 
 
</pre></font>

<p>
That is all in hud.cpp. Now we need to make our own file to contain the code for our SentryParts class. </p>

<h3>Client-side Sentry-parts code</h3>

<p>
Make a new file called something like "sentryparts.cpp" and add it to the cl_dll Source Files project (If the file doesnt appear in the workspace, press undo while the workspace window is selected and then just right click on the "Source Files" folder and "Add Files to folder", select the sentryparts.cpp file and OK). </p>
<p>In this new file we're going to add some code below.. </p>

<p>First we need to include some files... </p>

<font color="red"><pre>

#include "hud.h" 
#include "cl_util.h" 
#include "parsemsg.h" 
 
</pre></font>

<p>
Now declare the SentrtyParts message, this is the same name as the message name ("SentryParts") </p>

<font color="red"><pre>

DECLARE_MESSAGE(m_SentryParts, SentryParts) 
</pre></font>

<p>
Now declare the name of the sprite here, I've made my own sprite called sentryparts.spr (32x32 pixels), You can call it whatever you want, as long as the file exists so you can see it! </p>

<font color="red"><pre>

#define SPRITE_NAME "sprites/sentryparts.spr" 
 
</pre></font>
<p>
Note that the Init() Code below will hook the SentryParts message And make sure the class is called when we send the SentryParts net message </p>

<font color="red"><pre>

int CHudSentryParts ::Init(void) 
{ 
   HOOK_MESSAGE(SentryParts); 
   gHUD.AddHudElem(this); 

   return 1; 
} 
</pre></font>

<p>
The ViDInit part below will just initialise some variables or whever else you want to do, at the moment I've only got one variable to initialise so it looks very simple. </p>

<font color="red"><pre>

int CHudSentryParts ::VidInit(void) 
{ 
   m_hSpriteSentryParts1 = 0; 

   return 1; 
} 
 
</pre></font>

<p>
The draw funtion below will be called when the sprite is drawn on the hud. </p>

<font color="red"><pre>

int CHudSentryParts ::Draw(float flTime) 
{ 
   int r,g,b; 

   if ( !m_hSpriteSentryParts1 ) 
   { 
      m_hSpriteSentryParts1 = LoadSprite(SPRITE_NAME); 
   } 

   if( !m_hSpriteSentryParts1 ) 
      return 0; // Sprite doesn't exist, return 0 

   UnpackRGB(r, g, b, RGB_YELLOWISH); // "Yellowish" colour 
   SPR_Set(m_hSpriteSentryParts1, r, g, b); // Set these colours 

   int x = ScreenWidth - 64; // I've made my sprite 32 pixels wide so I just moved it 64 pixels from the edge of the screen 
   int y = ScreenHeight - (ScreenHeight/2); // I made it centre vertically. 

   // X and Y are positions on the HUD. 

   SPR_DrawAdditive(0, x, y, NULL); // Draw the sprite on X,Y 

   return 1; 

} 
 
</pre></font>

<p>The last bit is called when the message "SentryParts" is made, the READ_BYTE() will be the state of the sprite being shown (i.e. if it's 1, draw the sprite on the hud, if not then stop drawing it) </p>

<font color="red"><pre>

int CHudSentryParts ::MsgFunc_SentryParts(const char *pszName,  int iSize, void *pbuf ) 
{ 
   BEGIN_READ( pbuf, iSize ); 

   int flag = READ_BYTE(); 

   if (flag == 0) 
      m_iFlags &= ~HUD_ACTIVE;  // turn off the Draw function 
   else 
     m_iFlags |= HUD_ACTIVE; // else Draw it! 

   return 1; 
} 
 
</pre></font>
<br /><br />
<a href="http://www.gamedesign.net/book/print/541" title="Show a printer-friendly version of this book page and its sub-pages.">printer-friendly version</a> &middot; <a href="http://www.gamedesign.net/comment/reply/541#comment" title="Share your thoughts and opinions related to this posting.">Add new comment</a> &middot; 35 reads
</div><br />

			<!-- Box: Reply (main)-->
							<div class="body_box_header">Reply</div>
				<div class="body_box">
					<form action="http://www.gamedesign.net/comment/reply/541" method="post">
<a id="comment"></a>
<div class="form-item"><div class="title">Your name:</div>Anonymous</div>
<div class="form-item"><div class="title">Subject:</div><input type="text" maxlength="64" class="form-text" name="edit[subject]" size="50" value="" /></div>
<div class="form-item"><div class="title">Comment:</div><textarea wrap="virtual" cols="40" rows="10" name="edit[comment]" id="edit[comment]"></textarea></div>
<input type="hidden" name="edit[cid]" value="" />
<input type="hidden" name="edit[pid]" value="0" />
<input type="hidden" name="edit[nid]" value="541" />
<input type="submit" class="form-submit" name="op" value="Preview comment" />
<input type="submit" class="form-submit" name="op" value="Post comment" />

</form>
				</div><br />
															</div>
											</td>
										</tr>
										<tr>
											<td valign="top" width="522" height="41" background="images/body_footer.jpg">
												&nbsp;
											</td>
										</tr>
									</table>
								</td>
								<td valign="top" width="7">
									<img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" />
								</td>
								<td valign="top" width="200">
									<table border="0" cellpadding="0" cellspacing="0">	
													<!-- Box: User login (all)-->
						
			<tr><td valign="center" background="images/rsb_header.jpg" width="200" height="24"><div class="sidebar_head" align="center">User login</div></td></tr><tr><td valign="top" background="images/rsb_bodybg.jpg" width="200"><img src="images/rsb_bodytop.jpg" width="200" height="1" /><div class="sidebar"><div class="user-login-link"><div class="user-login-block">
<form action="http://www.gamedesign.net/user/login" method="post">
<input type="hidden" name="edit[destination]" value="http://www.gamedesign.net/comment/reply/541" />
<div class="form-item"><div class="title">Username:</div><input type="text" maxlength="64" class="form-text" name="edit[name]" size="15" value="" /></div>
<div class="form-item"><div class="title">Password:</div><input type="password" class="form-password" maxlength="64" name="edit[pass]" size="15" value="" /></div>
<input type="hidden" name="edit[remember_me]" value="0" />
<div class="form-item"><input type="checkbox" class="form-checkbox" name="edit[remember_me]" value="1" /> Remember me</div>
<input type="submit" class="form-submit" name="op" value="Log in" />

</form>
</div>
<div class="item-list"><ul><li><a href="http://www.gamedesign.net/user/register" title="Create a new user account.">Create new account</a></li><li><a href="http://www.gamedesign.net/user/password" title="Request new password via e-mail.">Request new password</a></li></ul></div></div></div><img src="images/rsb_bodybottom.jpg" width="200" height="1" /></td></tr><tr><td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td></tr>
			
						<!-- Box: Poll (all)-->
						
			<tr><td valign="center" background="images/rsb_header.jpg" width="200" height="24"><div class="sidebar_head" align="center">Poll</div></td></tr><tr><td valign="top" background="images/rsb_bodybg.jpg" width="200"><img src="images/rsb_bodytop.jpg" width="200" height="1" /><div class="sidebar"><div class="poll-title">What is the coolest weapon out of the original Half-Life?</div><br><div class="poll"><form action="/comment/reply/541" method="post"><div class="vote-form"><div class="choices"><div><input type="radio" name="pollvote[644]" value="0" />The Glock</div><div><input type="radio" name="pollvote[644]" value="1" />The Mp5</div><div><input type="radio" name="pollvote[644]" value="2" />The Snark</div><div><input type="radio" name="pollvote[644]" value="3" />The Gauss</div><div><input type="radio" name="pollvote[644]" value="4" />The Crowbar</div><div><input type="radio" name="pollvote[644]" value="5" />The satchel</div><div><input type="radio" name="pollvote[644]" value="6" />The Rpg</div><div><input type="radio" name="pollvote[644]" value="7" />Shotgun</div><div><input type="radio" name="pollvote[644]" value="8" />I dont care, if it kills its good</div></div><input type="submit" class="form-submit" name="vote" value="Vote" />
</div><div class="links"><a href="http://assets.aq2world.com/archive/websites/www.gamedesign.net/node/view/644#comment" title="Jump to the first comment of this posting.">2 comments</a> &middot; <a href="/comment/reply/541?pollresults[644]=1">View results</a> &middot; 21 reads &middot; <a href="http://www.gamedesign.net/poll" title="View the list of polls on this site.">Older polls</a></div></form></div></div><img src="images/rsb_bodybottom.jpg" width="200" height="1" /></td></tr><tr><td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td></tr>
			
						<!-- Box: Who's new (all)-->
						
			<tr><td valign="center" background="images/rsb_header.jpg" width="200" height="24"><div class="sidebar_head" align="center">Who's new</div></td></tr><tr><td valign="top" background="images/rsb_bodybg.jpg" width="200"><img src="images/rsb_bodytop.jpg" width="200" height="1" /><div class="sidebar"><div class="item-list"><ul><li><a href="http://www.gamedesign.net/user/view/2285" title="View user profile.">ratt30</a></li><li><a href="http://www.gamedesign.net/user/view/2284" title="View user profile.">dcchancy</a></li><li><a href="http://www.gamedesign.net/user/view/2283" title="View user profile.">mrsleepless</a></li><li><a href="http://www.gamedesign.net/user/view/2282" title="View user profile.">GameDrained</a></li><li><a href="http://www.gamedesign.net/user/view/2281" title="View user profile.">skinmaster</a></li></ul></div></div><img src="images/rsb_bodybottom.jpg" width="200" height="1" /></td></tr><tr><td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td></tr>
			
						<!-- Box: Who's online (all)-->
						
			<tr><td valign="center" background="images/rsb_header.jpg" width="200" height="24"><div class="sidebar_head" align="center">Who's online</div></td></tr><tr><td valign="top" background="images/rsb_bodybg.jpg" width="200"><img src="images/rsb_bodytop.jpg" width="200" height="1" /><div class="sidebar">There are currently 0 users and 34 guests online.</div><img src="images/rsb_bodybottom.jpg" width="200" height="1" /></td></tr><tr><td><img src="http://assets.aq2world.com/archive/websites/www.gamedesign.net/themes/rusted/images/spacer.gif" width="7" height="7" /></td></tr>
			
												</table>
								</td>
							</tr>
						</table>
					</td>
					<td valign="top" width="7">
						<img src="images/mh_lowerbg3.jpg" width="7" height="90" />
					</td>
				</tr>
			</table>
					</body>
		</html>
	